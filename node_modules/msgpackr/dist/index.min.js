!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).msgpackr={})}(this,(function(t){"use strict";var e,r,n;try{e=new TextDecoder}catch(t){}var i,s,o,u,a,l=0,c={},f=0,h=0,g=[],p={useRecords:!1,mapsAsObjects:!0};class d{}const y=new d;y.name="MessagePack 0xC1";var w=!1,b=2;try{new Function("")}catch(t){b=1/0}class m{constructor(t){t&&(!1===t.useRecords&&void 0===t.mapsAsObjects&&(t.mapsAsObjects=!0),t.sequential&&!1!==t.trusted&&(t.trusted=!0,t.structures||0==t.useRecords||(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,e){if(r)return Y((()=>(q(),this?this.unpack(t,e):m.prototype.unpack.call(p,t,e))));t.buffer||t.constructor!==ArrayBuffer||(t="undefined"!=typeof Buffer?Buffer.from(t):new Uint8Array(t)),"object"==typeof e?(n=e.end||t.length,l=e.start||0):(l=0,n=e>-1?e:t.length),h=0,s=null,o=null,r=t;try{a=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(e){if(r=null,t instanceof Uint8Array)throw e;throw new Error("Source must be a Uint8Array or Buffer but was a "+(t&&"object"==typeof t?t.constructor.name:typeof t))}if(this instanceof m){if(c=this,this.structures)return i=this.structures,S(e);(!i||i.length>0)&&(i=[])}else c=p,(!i||i.length>0)&&(i=[]);return S(e)}unpackMultiple(t,e){let r,n=0;try{w=!0;let i=t.length,s=this?this.unpack(t,i):H.unpack(t,i);if(!e){for(r=[s];l<i;)n=l,r.push(S());return r}if(!1===e(s,n,l))return;for(;l<i;)if(n=l,!1===e(S(),n,l))return}catch(t){throw t.lastPosition=n,t.values=r,t}finally{w=!1,q()}}_mergeStructures(t,e){t=t||[],Object.isFrozen(t)&&(t=t.map((t=>t.slice(0))));for(let e=0,r=t.length;e<r;e++){let r=t[e];r&&(r.isShared=!0,e>=32&&(r.highByte=e-32>>5))}t.sharedLength=t.length;for(let r in e||[])if(r>=0){let n=t[r],i=e[r];i&&(n&&((t.restoreStructures||(t.restoreStructures=[]))[r]=n),t[r]=i)}return this.structures=t}decode(t,e){return this.unpack(t,e)}}function S(t){try{if(!c.trusted&&!w){let t=i.sharedLength||0;t<i.length&&(i.length=t)}let t;if(c.randomAccessStructure&&r[l]<64&&r[l],t=A(),o&&(l=o.postBundlePosition,o=null),w&&(i.restoreStructures=null),l==n)i&&i.restoreStructures&&U(),i=null,r=null,u&&(u=null);else{if(l>n)throw new Error("Unexpected end of MessagePack data");if(!w){let e;try{e=JSON.stringify(t,((t,e)=>"bigint"==typeof e?`${e}n`:e)).slice(0,100)}catch(t){e="(JSON view not available "+t+")"}throw new Error("Data read, but end of buffer not reached "+e)}}return t}catch(t){throw i&&i.restoreStructures&&U(),q(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||l>n)&&(t.incomplete=!0),t}}function U(){for(let t in i.restoreStructures)i[t]=i.restoreStructures[t];i.restoreStructures=null}function A(){let t=r[l++];if(t<160){if(t<128){if(t<64)return t;{let e=i[63&t]||c.getStructures&&O()[63&t];return e?(e.read||(e.read=k(e,63&t)),e.read()):t}}if(t<144){if(t-=128,c.mapsAsObjects){let e={};for(let r=0;r<t;r++){let t=C();"__proto__"===t&&(t="__proto_"),e[t]=A()}return e}{let e=new Map;for(let r=0;r<t;r++)e.set(A(),A());return e}}{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=A();return c.freezeData?Object.freeze(e):e}}if(t<192){let e=t-160;if(h>=l)return s.slice(l-f,(l+=e)-f);if(0==h&&n<140){let t=e<16?L(e):F(e);if(null!=t)return t}return E(e)}{let e;switch(t){case 192:return null;case 193:return o?(e=A(),e>0?o[1].slice(o.position1,o.position1+=e):o[0].slice(o.position0,o.position0-=e)):y;case 194:return!1;case 195:return!0;case 196:if(e=r[l++],void 0===e)throw new Error("Unexpected end of buffer");return N(e);case 197:return e=a.getUint16(l),l+=2,N(e);case 198:return e=a.getUint32(l),l+=4,N(e);case 199:return R(r[l++]);case 200:return e=a.getUint16(l),l+=2,R(e);case 201:return e=a.getUint32(l),l+=4,R(e);case 202:if(e=a.getFloat32(l),c.useFloat32>2){let t=Z[(127&r[l])<<1|r[l+1]>>7];return l+=4,(t*e+(e>0?.5:-.5)>>0)/t}return l+=4,e;case 203:return e=a.getFloat64(l),l+=8,e;case 204:return r[l++];case 205:return e=a.getUint16(l),l+=2,e;case 206:return e=a.getUint32(l),l+=4,e;case 207:return"number"===c.int64AsType?(e=4294967296*a.getUint32(l),e+=a.getUint32(l+4)):"string"===c.int64AsType?e=a.getBigUint64(l).toString():"auto"===c.int64AsType?(e=a.getBigUint64(l),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=a.getBigUint64(l),l+=8,e;case 208:return a.getInt8(l++);case 209:return e=a.getInt16(l),l+=2,e;case 210:return e=a.getInt32(l),l+=4,e;case 211:return"number"===c.int64AsType?(e=4294967296*a.getInt32(l),e+=a.getUint32(l+4)):"string"===c.int64AsType?e=a.getBigInt64(l).toString():"auto"===c.int64AsType?(e=a.getBigInt64(l),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=a.getBigInt64(l),l+=8,e;case 212:if(e=r[l++],114==e)return z(63&r[l++]);{let t=g[e];if(t)return t.read?(l++,t.read(A())):t.noBuffer?(l++,t()):t(r.subarray(l,++l));throw new Error("Unknown extension "+e)}case 213:return e=r[l],114==e?(l++,z(63&r[l++],r[l++])):R(2);case 214:return R(4);case 215:return R(8);case 216:return R(16);case 217:return e=r[l++],h>=l?s.slice(l-f,(l+=e)-f):_(e);case 218:return e=a.getUint16(l),h>=(l+=2)?s.slice(l-f,(l+=e)-f):B(e);case 219:return e=a.getUint32(l),h>=(l+=4)?s.slice(l-f,(l+=e)-f):x(e);case 220:return e=a.getUint16(l),l+=2,T(e);case 221:return e=a.getUint32(l),l+=4,T(e);case 222:return e=a.getUint16(l),l+=2,M(e);case 223:return e=a.getUint32(l),l+=4,M(e);default:if(t>=224)return t-256;if(void 0===t){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+t)}}}const I=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function k(t,e){function r(){if(r.count++>b){let r=t.read=new Function("r","return function(){return "+(c.freezeData?"Object.freeze":"")+"({"+t.map((t=>"__proto__"===t?"__proto_:r()":I.test(t)?t+":r()":"["+JSON.stringify(t)+"]:r()")).join(",")+"})}")(A);return 0===t.highByte&&(t.read=v(e,t.read)),r()}let n={};for(let e=0,r=t.length;e<r;e++){let r=t[e];"__proto__"===r&&(r="__proto_"),n[r]=A()}return c.freezeData?Object.freeze(n):n}return r.count=0,0===t.highByte?v(e,r):r}const v=(t,e)=>function(){let n=r[l++];if(0===n)return e();let s=t<32?-(t+(n<<5)):t+(n<<5),o=i[s]||O()[s];if(!o)throw new Error("Record id is not defined for "+s);return o.read||(o.read=k(o,t)),o.read()};function O(){let t=Y((()=>(r=null,c.getStructures())));return i=c._mergeStructures(t,i)}var E=j,_=j,B=j,x=j;function j(t){let n;if(t<16&&(n=L(t)))return n;if(t>64&&e)return e.decode(r.subarray(l,l+=t));const i=l+t,s=[];for(n="";l<i;){const t=r[l++];if(0==(128&t))s.push(t);else if(192==(224&t)){const e=63&r[l++];s.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&r[l++],n=63&r[l++];s.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&r[l++])<<12|(63&r[l++])<<6|63&r[l++];e>65535&&(e-=65536,s.push(e>>>10&1023|55296),e=56320|1023&e),s.push(e)}else s.push(t);s.length>=4096&&(n+=D.apply(String,s),s.length=0)}return s.length>0&&(n+=D.apply(String,s)),n}function T(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=A();return c.freezeData?Object.freeze(e):e}function M(t){if(c.mapsAsObjects){let e={};for(let r=0;r<t;r++){let t=C();"__proto__"===t&&(t="__proto_"),e[t]=A()}return e}{let e=new Map;for(let r=0;r<t;r++)e.set(A(),A());return e}}var D=String.fromCharCode;function F(t){let e=l,n=new Array(t);for(let i=0;i<t;i++){const t=r[l++];if((128&t)>0)return void(l=e);n[i]=t}return D.apply(String,n)}function L(t){if(t<4){if(t<2){if(0===t)return"";{let t=r[l++];return(128&t)>1?void(l-=1):D(t)}}{let e=r[l++],n=r[l++];if((128&e)>0||(128&n)>0)return void(l-=2);if(t<3)return D(e,n);let i=r[l++];return(128&i)>0?void(l-=3):D(e,n,i)}}{let e=r[l++],n=r[l++],i=r[l++],s=r[l++];if((128&e)>0||(128&n)>0||(128&i)>0||(128&s)>0)return void(l-=4);if(t<6){if(4===t)return D(e,n,i,s);{let t=r[l++];return(128&t)>0?void(l-=5):D(e,n,i,s,t)}}if(t<8){let o=r[l++],u=r[l++];if((128&o)>0||(128&u)>0)return void(l-=6);if(t<7)return D(e,n,i,s,o,u);let a=r[l++];return(128&a)>0?void(l-=7):D(e,n,i,s,o,u,a)}{let o=r[l++],u=r[l++],a=r[l++],c=r[l++];if((128&o)>0||(128&u)>0||(128&a)>0||(128&c)>0)return void(l-=8);if(t<10){if(8===t)return D(e,n,i,s,o,u,a,c);{let t=r[l++];return(128&t)>0?void(l-=9):D(e,n,i,s,o,u,a,c,t)}}if(t<12){let f=r[l++],h=r[l++];if((128&f)>0||(128&h)>0)return void(l-=10);if(t<11)return D(e,n,i,s,o,u,a,c,f,h);let g=r[l++];return(128&g)>0?void(l-=11):D(e,n,i,s,o,u,a,c,f,h,g)}{let f=r[l++],h=r[l++],g=r[l++],p=r[l++];if((128&f)>0||(128&h)>0||(128&g)>0||(128&p)>0)return void(l-=12);if(t<14){if(12===t)return D(e,n,i,s,o,u,a,c,f,h,g,p);{let t=r[l++];return(128&t)>0?void(l-=13):D(e,n,i,s,o,u,a,c,f,h,g,p,t)}}{let d=r[l++],y=r[l++];if((128&d)>0||(128&y)>0)return void(l-=14);if(t<15)return D(e,n,i,s,o,u,a,c,f,h,g,p,d,y);let w=r[l++];return(128&w)>0?void(l-=15):D(e,n,i,s,o,u,a,c,f,h,g,p,d,y,w)}}}}}function V(){let t,e=r[l++];if(e<192)t=e-160;else switch(e){case 217:t=r[l++];break;case 218:t=a.getUint16(l),l+=2;break;case 219:t=a.getUint32(l),l+=4;break;default:throw new Error("Expected string")}return j(t)}function N(t){return c.copyBuffers?Uint8Array.prototype.slice.call(r,l,l+=t):r.subarray(l,l+=t)}function R(t){let e=r[l++];if(g[e]){let n;return g[e](r.subarray(l,n=l+=t),(t=>{l=t;try{return A()}finally{l=n}}))}throw new Error("Unknown extension type "+e)}var P=new Array(4096);function C(){let t=r[l++];if(!(t>=160&&t<192))return l--,A().toString();if(t-=160,h>=l)return s.slice(l-f,(l+=t)-f);if(!(0==h&&n<180))return E(t);let e,i=4095&(t<<5^(t>1?a.getUint16(l):t>0?r[l]:0)),o=P[i],u=l,c=l+t-3,g=0;if(o&&o.bytes==t){for(;u<c;){if(e=a.getUint32(u),e!=o[g++]){u=1879048192;break}u+=4}for(c+=3;u<c;)if(e=r[u++],e!=o[g++]){u=1879048192;break}if(u===c)return l=u,o.string;c-=3,u=l}for(o=[],P[i]=o,o.bytes=t;u<c;)e=a.getUint32(u),o.push(e),u+=4;for(c+=3;u<c;)e=r[u++],o.push(e);let p=t<16?L(t):F(t);return o.string=null!=p?p:E(t)}const z=(t,e)=>{let r=A().map((t=>t.toString())),n=t;void 0!==e&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let s=i[t];return s&&(s.isShared||w)&&((i.restoreStructures||(i.restoreStructures=[]))[t]=s),i[t]=r,r.read=k(r,n),r.read()};g[0]=()=>{},g[0].noBuffer=!0;let W="object"==typeof globalThis?globalThis:window;g[101]=()=>{let t=A();return(W[t[0]]||Error)(t[1])},g[105]=t=>{let e=a.getUint32(l-4);u||(u=new Map);let n,i=r[l];n=i>=144&&i<160||220==i||221==i?[]:{};let s={target:n};u.set(e,s);let o=A();return s.used?Object.assign(n,o):(s.target=o,o)},g[112]=t=>{let e=a.getUint32(l-4),r=u.get(e);return r.used=!0,r.target},g[115]=()=>new Set(A());const J=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((t=>t+"Array"));g[116]=t=>{let e=t[0],r=J[e];if(!r)throw new Error("Could not find typed array for code "+e);return new W[r](Uint8Array.prototype.slice.call(t,1).buffer)},g[120]=()=>{let t=A();return new RegExp(t[0],t[1])};const $=[];function Y(t){let e=n,g=l,p=f,d=h,y=s,b=u,m=o,S=new Uint8Array(r.slice(0,n)),U=i,A=i.slice(0,i.length),I=c,k=w,v=t();return n=e,l=g,f=p,h=d,s=y,u=b,o=m,r=S,w=k,(i=U).splice(0,i.length,...A),c=I,a=new DataView(r.buffer,r.byteOffset,r.byteLength),v}function q(){r=null,u=null,i=null}g[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=l;return l+=e-t.length,o=$,(o=[V(),V()]).position0=0,o.position1=0,o.postBundlePosition=l,l=r,A()},g[255]=t=>4==t.length?new Date(1e3*(16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3])):8==t.length?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+1e3*(4294967296*(3&t[3])+16777216*t[4]+(t[5]<<16)+(t[6]<<8)+t[7])):12==t.length?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+1e3*((128&t[4]?-281474976710656:0)+1099511627776*t[6]+4294967296*t[7]+16777216*t[8]+(t[9]<<16)+(t[10]<<8)+t[11])):new Date("invalid");const Z=new Array(147);for(let t=0;t<256;t++)Z[t]=+("1e"+Math.floor(45.15-.30103*t));const G=m;var H=new m({useRecords:!1});const K=H.unpack,Q=H.unpackMultiple,X=H.unpack,tt={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let et,rt,nt,it=new Float32Array(1),st=new Uint8Array(it.buffer,0,4);try{et=new TextEncoder}catch(t){}const ot="undefined"!=typeof Buffer,ut=ot?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,at=ot?Buffer:Uint8Array,lt=ot?4294967296:2144337920;let ct,ft,ht,gt,pt=0,dt=null;const yt=/[\u0080-\uFFFF]/,wt=Symbol("record-id");class bt extends m{constructor(t){let e,r,n,i;super(t),this.offset=0;let s=at.prototype.utf8Write?function(t,e){return ct.utf8Write(t,e,4294967295)}:!(!et||!et.encodeInto)&&function(t,e){return et.encodeInto(t,ct.subarray(e)).written},o=this;t||(t={});let u=t&&t.sequential,a=t.structures||t.saveStructures,l=t.maxSharedStructures;if(null==l&&(l=a?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&null==t.moreTypes&&(this.moreTypes=!0);let c=t.maxOwnStructures;null==c&&(c=a?32:64),this.structures||0==t.useRecords||(this.structures=[]);let f=l>32||c+l>64,h=l+64,g=l+c+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],d=0,y=0;this.pack=this.encode=function(t,s){if(ct||(ct=new ut(8192),ht=ct.dataView||(ct.dataView=new DataView(ct.buffer,0,8192)),pt=0),gt=ct.length-10,gt-pt<2048?(ct=new ut(ct.length),ht=ct.dataView||(ct.dataView=new DataView(ct.buffer,0,ct.length)),gt=ct.length-10,pt=0):pt=pt+7&2147483640,e=pt,i=o.structuredClone?new Map:null,o.bundleStrings&&"string"!=typeof t?(dt=[],dt.size=1/0):dt=null,n=o.structures,n){n.uninitialized&&(n=o._mergeStructures(o.getStructures()));let t=n.sharedLength||0;if(t>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let e=0;e<t;e++){let t=n[e];if(!t)continue;let r,i=n.transitions;for(let e=0,n=t.length;e<n;e++){let n=t[e];r=i[n],r||(r=i[n]=Object.create(null)),i=r}i[wt]=e+64}this.lastNamedStructuresLength=t}u||(n.nextId=t+64)}r&&(r=!1);try{o.randomAccessStructure&&t&&t.constructor&&t.constructor===Object?I(t):b(t);let a=dt;if(dt&&At(e,b,0),i&&i.idsToInsert){let t=i.idsToInsert.sort(((t,e)=>t.offset>e.offset?1:-1)),r=t.length,n=-1;for(;a&&r>0;){let i=t[--r].offset+e;i<a.stringsPosition+e&&-1===n&&(n=0),i>a.position+e?n>=0&&(n+=6):(n>=0&&(ht.setUint32(a.position+e,ht.getUint32(a.position+e)+n),n=-1),a=a.previous,r++)}n>=0&&a&&ht.setUint32(a.position+e,ht.getUint32(a.position+e)+n),pt+=6*t.length,pt>gt&&S(pt),o.offset=pt;let s=function(t,e){let r,n=6*e.length,i=t.length-n;for(;r=e.pop();){let e=r.offset,s=r.id;t.copyWithin(e+n,e,i),n-=6;let o=e+n;t[o++]=214,t[o++]=105,t[o++]=s>>24,t[o++]=s>>16&255,t[o++]=s>>8&255,t[o++]=255&s,i=e}return t}(ct.subarray(e,pt),t);return i=null,s}return o.offset=pt,s&jt?(ct.start=e,ct.end=pt,ct):ct.subarray(e,pt)}finally{if(n){y<10&&y++;let i=n.sharedLength||0;if(n.length>i&&!u&&(n.length=i),d>1e4)n.transitions=null,y=0,d=0,p.length>0&&(p=[]);else if(p.length>0&&!u){for(let t=0,e=p.length;t<e;t++)p[t][wt]=0;p=[]}if(r&&o.saveStructures){let r=ct.subarray(e,pt),s=function(t,e){return t.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},t}(n,o);return!1===o.saveStructures(s,s.isCompatible)?o.pack(t):(o.lastNamedStructuresLength=i,r)}}s&Tt&&(pt=e)}};const w=t=>{var e=t.length;e<16?ct[pt++]=144|e:e<65536?(ct[pt++]=220,ct[pt++]=e>>8,ct[pt++]=255&e):(ct[pt++]=221,ht.setUint32(pt,e),pt+=4);for(let r=0;r<e;r++)b(t[r])},b=t=>{pt>gt&&(ct=S(pt));var r,n=typeof t;if("string"===n){let n,i=t.length;if(dt&&i>=4&&i<4096){if((dt.size+=i)>21760){let t,r,n=(dt[0]?3*dt[0].length+dt[1].length:0)+10;pt+n>gt&&(ct=S(pt+n)),dt.position?(r=dt,ct[pt]=200,pt+=3,ct[pt++]=98,t=pt-e,pt+=4,At(e,b,0),ht.setUint16(t+e-3,pt-e-t)):(ct[pt++]=214,ct[pt++]=98,t=pt-e,pt+=4),dt=["",""],dt.previous=r,dt.size=0,dt.position=t}let r=yt.test(t);return dt[r?0:1]+=t,ct[pt++]=193,void b(r?-i:i)}n=i<32?1:i<256?2:i<65536?3:5;let o=3*i;if(pt+o>gt&&(ct=S(pt+o)),i<64||!s){let e,s,o,u=pt+n;for(e=0;e<i;e++)s=t.charCodeAt(e),s<128?ct[u++]=s:s<2048?(ct[u++]=s>>6|192,ct[u++]=63&s|128):55296==(64512&s)&&56320==(64512&(o=t.charCodeAt(e+1)))?(s=65536+((1023&s)<<10)+(1023&o),e++,ct[u++]=s>>18|240,ct[u++]=s>>12&63|128,ct[u++]=s>>6&63|128,ct[u++]=63&s|128):(ct[u++]=s>>12|224,ct[u++]=s>>6&63|128,ct[u++]=63&s|128);r=u-pt-n}else r=s(t,pt+n);r<32?ct[pt++]=160|r:r<256?(n<2&&ct.copyWithin(pt+2,pt+1,pt+1+r),ct[pt++]=217,ct[pt++]=r):r<65536?(n<3&&ct.copyWithin(pt+3,pt+2,pt+2+r),ct[pt++]=218,ct[pt++]=r>>8,ct[pt++]=255&r):(n<5&&ct.copyWithin(pt+5,pt+3,pt+3+r),ct[pt++]=219,ht.setUint32(pt,r),pt+=4),pt+=r}else if("number"===n)if(t>>>0===t)t<32||t<128&&!1===this.useRecords||t<64&&!this.randomAccessStructure?ct[pt++]=t:t<256?(ct[pt++]=204,ct[pt++]=t):t<65536?(ct[pt++]=205,ct[pt++]=t>>8,ct[pt++]=255&t):(ct[pt++]=206,ht.setUint32(pt,t),pt+=4);else if(t>>0===t)t>=-32?ct[pt++]=256+t:t>=-128?(ct[pt++]=208,ct[pt++]=t+256):t>=-32768?(ct[pt++]=209,ht.setInt16(pt,t),pt+=2):(ct[pt++]=210,ht.setInt32(pt,t),pt+=4);else{let e;if((e=this.useFloat32)>0&&t<4294967296&&t>=-2147483648){let r;if(ct[pt++]=202,ht.setFloat32(pt,t),e<4||(r=t*Z[(127&ct[pt])<<1|ct[pt+1]>>7])>>0===r)return void(pt+=4);pt--}ct[pt++]=203,ht.setFloat64(pt,t),pt+=8}else if("object"===n)if(t){if(i){let r=i.get(t);if(r){if(!r.id){let t=i.idsToInsert||(i.idsToInsert=[]);r.id=t.push(r)}return ct[pt++]=214,ct[pt++]=112,ht.setUint32(pt,r.id),void(pt+=4)}i.set(t,{offset:pt-e})}let n=t.constructor;if(n===Object)m(t,!0);else if(n===Array)w(t);else if(n===Map)if(this.mapAsEmptyObject)ct[pt++]=128;else{(r=t.size)<16?ct[pt++]=128|r:r<65536?(ct[pt++]=222,ct[pt++]=r>>8,ct[pt++]=255&r):(ct[pt++]=223,ht.setUint32(pt,r),pt+=4);for(let[e,r]of t)b(e),b(r)}else{for(let e=0,r=rt.length;e<r;e++){if(t instanceof nt[e]){let r=rt[e];if(r.write){r.type&&(ct[pt++]=212,ct[pt++]=r.type,ct[pt++]=0);let e=r.write.call(this,t);return void(e===t?Array.isArray(t)?w(t):m(t):b(e))}let n,i=ct,s=ht,o=pt;ct=null;try{n=r.pack.call(this,t,(t=>(ct=i,i=null,pt+=t,pt>gt&&S(pt),{target:ct,targetView:ht,position:pt-t})),b)}finally{i&&(ct=i,ht=s,pt=o,gt=ct.length-10)}return void(n&&(n.length+pt>gt&&S(n.length+pt),pt=Ut(n,ct,pt,r.type)))}}if(Array.isArray(t))w(t);else{if(t.toJSON)return b(t.toJSON());m(t,!t.hasOwnProperty)}}}else ct[pt++]=192;else if("boolean"===n)ct[pt++]=t?195:194;else if("bigint"===n){if(t<BigInt(1)<<BigInt(63)&&t>=-(BigInt(1)<<BigInt(63)))ct[pt++]=211,ht.setBigInt64(pt,t);else if(t<BigInt(1)<<BigInt(64)&&t>0)ct[pt++]=207,ht.setBigUint64(pt,t);else{if(!this.largeBigIntToFloat)throw new RangeError(t+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ct[pt++]=203,ht.setFloat64(pt,Number(t))}pt+=8}else if("undefined"===n)this.encodeUndefinedAsNil?ct[pt++]=192:(ct[pt++]=212,ct[pt++]=0,ct[pt++]=0);else{if("function"!==n)throw new Error("Unknown type: "+n);b(this.writeFunction&&this.writeFunction())}},m=!1===this.useRecords?this.variableMapSize?t=>{let e,r=Object.keys(t),n=r.length;n<16?ct[pt++]=128|n:n<65536?(ct[pt++]=222,ct[pt++]=n>>8,ct[pt++]=255&n):(ct[pt++]=223,ht.setUint32(pt,n),pt+=4);for(let i=0;i<n;i++)b(e=r[i]),b(t[e])}:(t,r)=>{ct[pt++]=222;let n=pt-e;pt+=2;let i=0;for(let e in t)(r||t.hasOwnProperty(e))&&(b(e),b(t[e]),i++);ct[n+++e]=i>>8,ct[n+e]=255&i}:t.progressiveRecords&&!f?(t,r)=>{let i,s,o=n.transitions||(n.transitions=Object.create(null)),u=pt++-e;for(let a in t)if(r||t.hasOwnProperty(a)){if(i=o[a],i)o=i;else{let r=Object.keys(t),l=o;o=n.transitions;let c=0;for(let t=0,e=r.length;t<e;t++){let e=r[t];i=o[e],i||(i=o[e]=Object.create(null),c++),o=i}u+e+1==pt?(pt--,U(o,r,c)):A(o,r,u,c),s=!0,o=l[a]}b(t[a])}if(!s){let r=o[wt];r?ct[u+e]=r:A(o,Object.keys(t),u,0)}}:(t,e)=>{let r,i=n.transitions||(n.transitions=Object.create(null)),s=0;for(let n in t)(e||t.hasOwnProperty(n))&&(r=i[n],r||(r=i[n]=Object.create(null),s++),i=r);let o=i[wt];o?o>=96&&f?(ct[pt++]=96+(31&(o-=96)),ct[pt++]=o>>5):ct[pt++]=o:U(i,i.__keys__||Object.keys(t),s);for(let r in t)(e||t.hasOwnProperty(r))&&b(t[r])},S=t=>{let r;if(t>16777216){if(t-e>lt)throw new Error("Packed buffer would be larger than maximum buffer size");r=Math.min(lt,4096*Math.round(Math.max((t-e)*(t>67108864?1.25:2),4194304)/4096))}else r=1+(Math.max(t-e<<2,ct.length-1)>>12)<<12;let n=new ut(r);return ht=n.dataView||(n.dataView=new DataView(n.buffer,0,r)),t=Math.min(t,ct.length),ct.copy?ct.copy(n,0,e,t):n.set(ct.slice(e,t)),pt-=e,e=0,gt=n.length-10,ct=n},U=(t,e,i)=>{let s=n.nextId;s||(s=64),s<h&&this.shouldShareStructure&&!this.shouldShareStructure(e)?(s=n.nextOwnId,s<g||(s=h),n.nextOwnId=s+1):(s>=g&&(s=h),n.nextId=s+1);let o=e.highByte=s>=96&&f?s-96>>5:-1;t[wt]=s,t.__keys__=e,n[s-64]=e,s<h?(e.isShared=!0,n.sharedLength=s-63,r=!0,o>=0?(ct[pt++]=96+(31&s),ct[pt++]=o):ct[pt++]=s):(o>=0?(ct[pt++]=213,ct[pt++]=114,ct[pt++]=96+(31&s),ct[pt++]=o):(ct[pt++]=212,ct[pt++]=114,ct[pt++]=s),i&&(d+=y*i),p.length>=c&&(p.shift()[wt]=0),p.push(t),b(e))},A=(t,r,n,i)=>{let s=ct,o=pt,u=gt,a=e;ct=ft,pt=0,e=0,ct||(ft=ct=new ut(8192)),gt=ct.length-10,U(t,r,i),ft=ct;let l=pt;if(ct=s,pt=o,gt=u,e=a,l>1){let t=pt+l-1;t>gt&&S(t);let r=n+e;ct.copyWithin(r+l,r+1,pt),ct.set(ft.slice(0,l),r),pt=t}else ct[n+e]=ft[0]},I=(t,e)=>{let i=undefined(t,ct,pt,n,S,((t,e,n)=>{if(n)return r=!0;pt=e;let i=ct;return b(t),i!==ct?{position:pt,targetView:ht,target:ct}:pt}),this);if(0===i)return m(t,!0);pt=i}}useBuffer(t){ct=t,ht=new DataView(ct.buffer,ct.byteOffset,ct.byteLength),pt=0}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}function mt(t,e,r,n){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:u}=r(7+i);s[o++]=201,u.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function St(t,e){let r=t.byteLength;var n,i;if(r<256){var{target:n,position:i}=e(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=e(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=255&r}else{var{target:n,position:i,targetView:s}=e(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(t,i)}function Ut(t,e,r,n){let i=t.length;switch(i){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:i<256?(e[r++]=199,e[r++]=i):i<65536?(e[r++]=200,e[r++]=i>>8,e[r++]=255&i):(e[r++]=201,e[r++]=i>>24,e[r++]=i>>16&255,e[r++]=i>>8&255,e[r++]=255&i)}return e[r++]=n,e.set(t,r),r+=i}function At(t,e,r){if(dt.length>0){ht.setUint32(dt.position+t,pt+r-dt.position-t),dt.stringsPosition=pt-t;let n=dt;dt=null,e(n[0]),e(n[1])}}nt=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,d],rt=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||0===t.getMilliseconds())&&n>=0&&n<4294967296){let{target:t,targetView:r,position:i}=e(6);t[i++]=214,t[i++]=255,r.setUint32(i,n)}else if(n>0&&n<4294967296){let{target:r,targetView:i,position:s}=e(10);r[s++]=215,r[s++]=255,i.setUint32(s,4e6*t.getMilliseconds()+(n/1e3/4294967296>>0)),i.setUint32(s+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:t,targetView:n,position:i}=e(3);t[i++]=212,t[i++]=255,t[i++]=255}else{let{target:r,targetView:i,position:s}=e(15);r[s++]=199,r[s++]=12,r[s++]=255,i.setUint32(s,1e6*t.getMilliseconds()),i.setBigInt64(s+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){if(this.setAsEmptyObject)return e(0),r({});let n=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([t.name,t.message])}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?mt(t,16,e):St(ot?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==at&&this.moreTypes?mt(t,J.indexOf(r.name),e):St(t,e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];let It=new bt({useRecords:!1});const kt=It.pack,vt=It.pack,Ot=bt,{NEVER:Et,ALWAYS:_t,DECIMAL_ROUND:Bt,DECIMAL_FIT:xt}=tt,jt=512,Tt=1024;const Mt=function(t,e={}){if(!t||"object"!=typeof t)throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const r=new m(e);let n;const i=t=>{let e;n&&(t=Buffer.concat([n,t]),n=void 0);try{e=r.unpackMultiple(t)}catch(r){if(!r.incomplete)throw r;n=t.slice(r.lastPosition),e=r.values}return e};return"function"==typeof t[Symbol.iterator]?function*(){for(const e of t)yield*i(e)}():"function"==typeof t[Symbol.asyncIterator]?async function*(){for await(const e of t)yield*i(e)}():void 0},Dt=function(t,e={}){if(t&&"object"==typeof t){if("function"==typeof t[Symbol.iterator])return function*(t,e){const r=new bt(e);for(const e of t)yield r.pack(e)}(t,e);if("function"==typeof t.then||"function"==typeof t[Symbol.asyncIterator])return async function*(t,e){const r=new bt(e);for await(const e of t)yield r.pack(e)}(t,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable")};t.ALWAYS=_t,t.C1=y,t.DECIMAL_FIT=xt,t.DECIMAL_ROUND=Bt,t.Decoder=G,t.Encoder=Ot,t.FLOAT32_OPTIONS=tt,t.NEVER=Et,t.Packr=bt,t.REUSE_BUFFER_MODE=jt,t.Unpackr=m,t.addExtension=function(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");nt.unshift(t.Class),rt.unshift(t)}!function(t){t.unpack?g[t.type]=t.unpack:g[t.type]=t}(t)},t.clearSource=q,t.decode=X,t.decodeIter=Mt,t.encode=vt,t.encodeIter=Dt,t.isNativeAccelerationEnabled=!1,t.mapsAsObjects=!0,t.pack=kt,t.roundFloat32=function(t){it[0]=t;let e=Z[(127&st[3])<<1|st[2]>>7];return(e*t+(t>0?.5:-.5)>>0)/e},t.unpack=K,t.unpackMultiple=Q,t.useRecords=!1}));
//# sourceMappingURL=index.min.js.map
